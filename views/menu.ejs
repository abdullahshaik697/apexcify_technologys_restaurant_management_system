<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>

    <title>MENU</title>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center pb-8">
  <nav class="bg-gray-900 text-white px-6 py-3 shadow-md w-full mb-2">
    <div class="container mx-auto flex justify-between items-center">
      <!-- Logo / Brand -->
      <div class="text-xl font-bold tracking-wide">
        Restaurant Panel
      </div>
  
      <!-- Nav Links -->
      <ul class="flex space-x-6">
        <li>
          <a href="/api/home" class="hover:text-yellow-400 transition">Home</a>
        </li>
        <li>
          <a href="/api/home/orders" class="hover:text-yellow-400 transition">Orders</a>
        </li>
        <li>
          <a href="/api/home/reservations" class="hover:text-yellow-400 transition">Reservations</a>
        </li>
        <li>
          <a href="/api/home/tables" class="hover:text-yellow-400 transition">Tables</a>
        </li>
        <li>
          <a href="/api/home/menu" class="hover:text-yellow-400 transition">Menu</a>
        </li>
        <li>
            <a href="/api/home/inventory" class="hover:text-yellow-400 transition">Inventory</a>
        </li>
    </ul>
</div>
</nav>
  <h2 class="text-3xl font-bold text-gray-800 mb-6">Menu Items</h2>
 
  <!-- Form -->
  <form action="/api/home/menu" method="POST" id="menuItemForm"
        class="bg-white shadow-md rounded-xl p-6 w-full max-w-2xl mb-6 space-y-4">

    <input type="hidden" name="menuItemId" id="menuItemId">

    <input type="text" name="name" placeholder="Dish Name" id="menuItemName" required
           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">

    <input type="text" name="description" placeholder="Description" id="menuItemDescription" required
           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">

    <input type="number" name="price" placeholder="Price" id="menuItemPrice" required
           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">

    <select name="availability" required id="menuItemAvailability"
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      <option value="" hidden>-- Select Availability --</option>
      <option value="Available">Available</option>
      <option value="Not Available">Not Available</option>
    </select>

    <button type="submit" id="submitBtn"
            class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition">
      Add Dish
    </button>
  </form>

  <!-- Back Button -->
  <button onclick="goHome()" 
          class="mb-6 bg-gray-700 text-white px-5 py-2 rounded-lg hover:bg-gray-800 transition">
    Back to Home ->
  </button>

  <hr class="w-full max-w-5xl border-gray-300 mb-6">

  <!-- Table -->
  <div class="overflow-x-auto w-full max-w-5xl">
    <table class="w-full bg-white shadow-md rounded-xl overflow-hidden">
      <thead class="bg-blue-600 text-white">
        <tr>
          <th class="py-3 px-4 text-left">Name</th>
          <th class="py-3 px-4 text-left">Description</th>
          <th class="py-3 px-4 text-left">Price</th>
          <th class="py-3 px-4 text-left">Availability</th>
          <th class="py-3 px-4 text-center">Update Item</th>
          <th class="py-3 px-4 text-center">Delete Item</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% menuItems.forEach(menuItem => { %>
          <tr class="hover:bg-gray-50">
            <td class="py-3 px-4"><%= menuItem.name %></td>
            <td class="py-3 px-4"><%= menuItem.description %></td>
            <td class="py-3 px-4"><%= menuItem.price %></td>
            <td class="py-3 px-4 font-medium"><%= menuItem.availability %></td>
            <td class="py-3 px-4 text-center">
              <button onclick="editItem('<%= menuItem._id %>','<%= menuItem.name %>', '<%= menuItem.description %>', '<%= menuItem.price %>', '<%= menuItem.availability %>')" 
                      class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                Update
              </button>
            </td>
            <td class="py-3 px-4 text-center">
              <button onclick="deleteItem('<%= menuItem._id %>')" 
                      class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                Delete
              </button>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

</body>

<script>
const editItem = async (id, name, description, price, availability ) =>{

  const menuItemForm = document.getElementById("menuItemForm")
  document.getElementById("menuItemId").value = id;
  document.getElementById("menuItemName").value = name;
  document.getElementById("menuItemDescription").value = description;
  document.getElementById("menuItemPrice").value = price;
  document.getElementById("menuItemAvailability").value = availability;
  
  document.getElementById("submitBtn").innerText = "Update";

  menuItemForm.onsubmit = async (e) =>{
    e.preventDefault()
    try {
    const response = await fetch(`/api/home/menu/${id}`,{
    method: "PATCH",
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        name: document.getElementById("menuItemName").value,
        description:document.getElementById("menuItemDescription").value,
        price:document.getElementById("menuItemPrice").value,
        availability: document.getElementById("menuItemAvailability").value
    })

}) 
    window.location.reload()
} catch (error) {

    console.log('Update Menu Item Error: ', error);
    
}
  }

}


const deleteItem = async (id) =>{

    try {
    const response = await fetch(`/api/home/menu/${id}`,{
        method: "DELETE"
    }) 
    window.location.reload()
        
    } catch (error) {

        console.log('Delete Menu Item Error: ', error);
        
    }

}

const goHome = ()=>{

  try {
    
    window.location.replace("/api/home")
  } catch (error) {
    console.log(error);
    
  }
}
</script>
</html>